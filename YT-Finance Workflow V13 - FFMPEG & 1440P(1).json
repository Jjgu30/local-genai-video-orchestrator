{
  "name": "YT-Finance Workflow V13 - FFMPEG & 1440P",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/audio/transcriptions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "=data"
            },
            {
              "name": "model",
              "value": "whisper-1"
            },
            {
              "name": "response_format",
              "value": "verbose_json"
            },
            {
              "name": "timestamp_granularities[]",
              "value": "word"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1360,
        960
      ],
      "id": "27e58c1c-6696-46ee-b3af-d70684cb4d5d",
      "name": "HTTP Request",
      "credentials": {
        "openAiApi": {
          "id": "IwPHIdqTQqLEO1sY",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// =========================================================\n// INPUT HANDLING\n// =========================================================\nconst input = $input.first().json;\nconst words = input.words || (input.text ? input.text.words : []);\nconst segments = input.segments || [];\n\n// SAFE ID FETCH\nlet parentId = \"TEST_MODE_ID\"; \ntry {\n    const parentNode = $('Get many rows5') || $('Get many rows1'); \n    if (parentNode && parentNode.first()) {\n        parentId = parentNode.first().json.id;\n    }\n} catch (e) {}\n\n// =========================================================\n// CONFIGURATION: SEMANTIC VISUAL PACING\n// =========================================================\nconst MIN_SCENE = 2.0;       \nconst SOFT_CAP = 4.5;        \nconst HARD_CAP = 8.5;        \nconst SILENCE_THRESH = 0.12; \n\n// BAD ENDINGS: Never cut on these words\nconst BAD_ENDINGS = new Set(['the', 'a', 'an', 'and', 'or', 'of', 'in', 'to', 'is', 'at', 'with', 'for']);\n\n// =========================================================\n// PASS 1: ATOMIZER\n// =========================================================\nconst segmentEndTimes = new Set(segments.map(s => Math.round(s.end * 100)));\nfunction isSegmentEnd(seconds) { return segmentEndTimes.has(Math.round(seconds * 100)); }\n\n// Helper for SRT Time format (Required for your File Saver)\nfunction toSRTTime(seconds) {\n  const date = new Date(0);\n  date.setSeconds(seconds);\n  const time = date.toISOString().substr(11, 8);\n  const ms = (seconds % 1).toFixed(3).substring(2);\n  return `${time},${ms}`;\n}\n\nlet allPhrases = [];\nlet currentPhrase = { words: [], start: null, end: null, text: \"\" };\n\nfunction flushPhrase(isHardStop = false) {\n  if (currentPhrase.words.length > 0) {\n    currentPhrase.start = currentPhrase.words[0].start;\n    currentPhrase.end = currentPhrase.words[currentPhrase.words.length - 1].end;\n    currentPhrase.duration = currentPhrase.end - currentPhrase.start;\n    currentPhrase.text = currentPhrase.words.map(w => w.word).join(\" \").trim();\n    currentPhrase.isSentenceEnd = isHardStop || isSegmentEnd(currentPhrase.end);\n    allPhrases.push(currentPhrase);\n    currentPhrase = { words: [], start: null, end: null, text: \"\" };\n  }\n}\n\nwords.forEach((w, index) => {\n  currentPhrase.words.push(w);\n  const isSentenceBreak = isSegmentEnd(w.end);\n  let isSilenceBreak = false;\n  const nextWord = words[index + 1];\n  \n  if (nextWord && (nextWord.start - w.end >= SILENCE_THRESH)) isSilenceBreak = true;\n  const currentDuration = (w.end - (currentPhrase.words[0] ? currentPhrase.words[0].start : w.start));\n\n  if (isSentenceBreak) flushPhrase(true);\n  else if (isSilenceBreak) flushPhrase(false);\n  else if (currentDuration > 4.0) flushPhrase(false);\n});\nflushPhrase();\n\n// =========================================================\n// PASS 2: COMPOSER (Semantic Aware)\n// =========================================================\nlet finalScenes = [];\nlet buffer = { phrases: [], duration: 0 };\n\nallPhrases.forEach((phrase, index) => {\n  const isLast = index === allPhrases.length - 1;\n  const newDuration = buffer.duration + phrase.duration;\n  \n  let endsWithBadWord = false;\n  if (buffer.phrases.length > 0) {\n      const lastTxt = buffer.phrases[buffer.phrases.length - 1].text;\n      const lastWord = lastTxt.split(' ').pop().toLowerCase().replace(/[^a-z]/g, '');\n      if (BAD_ENDINGS.has(lastWord)) endsWithBadWord = true;\n  }\n\n  if (buffer.phrases.length === 0) {\n    buffer.phrases.push(phrase);\n    buffer.duration = phrase.duration;\n  } \n  else {\n    if (endsWithBadWord) {\n         buffer.phrases.push(phrase);\n         buffer.duration = newDuration;\n    }\n    else if (buffer.phrases[buffer.phrases.length-1].isSentenceEnd && buffer.duration > MIN_SCENE) {\n        finalScenes.push(buffer);\n        buffer = { phrases: [phrase], duration: phrase.duration };\n    }\n    else if (buffer.duration > SOFT_CAP) {\n        finalScenes.push(buffer);\n        buffer = { phrases: [phrase], duration: phrase.duration };\n    }\n    else if (newDuration > HARD_CAP) {\n        finalScenes.push(buffer);\n        buffer = { phrases: [phrase], duration: phrase.duration };\n    }\n    else {\n        buffer.phrases.push(phrase);\n        buffer.duration = newDuration;\n    }\n  }\n  \n  if (isLast) {\n    if (buffer.duration < 2.0 && finalScenes.length > 0) {\n      const prevScene = finalScenes[finalScenes.length - 1];\n      if (prevScene.duration + buffer.duration < HARD_CAP + 2.0) {\n        prevScene.phrases.push(...buffer.phrases);\n        prevScene.duration += buffer.duration;\n        buffer = null; \n      }\n    }\n    if (buffer) finalScenes.push(buffer);\n  }\n});\n\n// =========================================================\n// OUTPUT (With SRT Content Restored)\n// =========================================================\nlet srt = '';\nconst mappedSegments = finalScenes.map((scene, i) => {\n  const start = scene.phrases[0].start;\n  const end = scene.phrases[scene.phrases.length - 1].end;\n  const text = scene.phrases.map(p => p.text).join(\" \");\n  \n  // Re-added this line to fix the error in the next node\n  srt += `${i + 1}\\n${toSRTTime(start)} --> ${toSRTTime(end)}\\n${text}\\n\\n`;\n  \n  return {\n    parent_id: parentId,\n    id: i + 1,\n    word: text,\n    start_time: Math.round(start * 100) / 100,\n    end_time: Math.round(end * 100) / 100,\n    duration: Math.round((end - start) * 100) / 100\n  };\n});\n\n// Output BOTH the SRT string (for the File node) and Segments (for the Loop)\nreturn [{ json: { srtContent: srt, Segments: mappedSegments } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        960
      ],
      "id": "e6154a73-88d0-4d99-b4ef-28c2722c5e2e",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "operation": "toText",
        "sourceProperty": "srtContent",
        "options": {
          "fileName": "captions.srt"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        1760,
        960
      ],
      "id": "fb797bd3-fcb2-4f50-986e-d95415b177d1",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776186,
        "rowId": "={{ $('Get many rows5').item.json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604582,
              "fieldValue": "={{ $('HTTP Request1').item.json.url }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        2176,
        960
      ],
      "id": "a1cbbf3e-2875-40b1-95ed-05950faa7ef1",
      "name": "Update a row",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.baserow.io/api/user-files/upload-file/",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1968,
        960
      ],
      "id": "a65a0831-a559-4bb4-93d4-4283dbc7e7dc",
      "name": "HTTP Request1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "gvKd90Uzwvft8lDn",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776290,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604671,
                "operator": "empty"
              },
              {
                "field": 6604661,
                "operator": "not_empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1008,
        2240
      ],
      "id": "8fa3a4ec-e8fb-4b0c-80a9-ee1ef69ceb6a",
      "name": "Get Scenes",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1184,
        2240
      ],
      "id": "5be9d8e0-68f2-483b-b509-9e329eb08a1a",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.baserow.io/api/user-files/upload-file/",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        2256
      ],
      "id": "2815d00b-87e7-41e0-95ed-cb1beb0dee78",
      "name": "HTTP - Upload To Baserow",
      "credentials": {
        "httpHeaderAuth": {
          "id": "gvKd90Uzwvft8lDn",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776290,
        "rowId": "={{ $('Loop Over Items').item.json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604671,
              "fieldValue": "={{ $json.name }}"
            },
            {
              "fieldId": 6604676,
              "fieldValue": "Processing"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1856,
        2256
      ],
      "id": "d72beb5d-f2e1-4d4c-9366-f76a823c8306",
      "name": "Update a row2",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        688,
        2240
      ],
      "id": "17bfcb76-e1ff-45e2-977a-854de9955f3d",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776186,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604680,
                "operator": "empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        976,
        2624
      ],
      "id": "f2de2c95-5814-4b07-a9fc-06e2a037d920",
      "name": "Get Video1",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "Scenes",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1184,
        2624
      ],
      "id": "315451c0-3870-4e1f-a6b1-e99982dac32d",
      "name": "Split Out2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1584,
        2624
      ],
      "id": "d6e06a70-bd89-48b6-add1-54c6d509cc80",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776290,
        "rowId": "={{ $('Loop Over Items1').item.json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604672,
              "fieldValue": "={{ $json.url }}"
            },
            {
              "fieldId": 6604676,
              "fieldValue": "Done"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        2384,
        2720
      ],
      "id": "9e63c3d6-b14e-4f86-934c-8200b4d4978e",
      "name": "Update a row3",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776290,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604659,
                "value": "={{ $json.id }}"
              },
              {
                "field": 6604672,
                "operator": "empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1376,
        2624
      ],
      "id": "d3ff52e8-16ef-4004-b53e-33b11dece775",
      "name": "Get many rows2",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "Scenes",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1200,
        3088
      ],
      "id": "cae7b030-b199-4c41-b72d-b76eb14f3da6",
      "name": "Split Out1"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "Video Clip URL"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1616,
        3088
      ],
      "id": "0ee22bc0-134c-4017-9104-a1d7f268d69e",
      "name": "Aggregate2"
    },
    {
      "parameters": {
        "jsCode": "// Extract the array of URLs\nconst urls = items[0].json[\"Video Clip URL\"] || [];\n\n// Map URLs into the required structure\nconst formattedURLs = urls.map(url => ({ \"video_url\": url }));\n\n// Return the transformed data\nreturn [{\n    json: {\n        \"video_urls\": formattedURLs\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1824,
        3088
      ],
      "id": "9b8a8604-04de-4705-8ba2-c4713851c4e0",
      "name": "Video URL to Array"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8080/v1/video/concatenate",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"video_urls\": {{ JSON.stringify($json.video_urls) }},\n    \"id\": \"{{ $('Get Videos').item.json.id }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2032,
        3088
      ],
      "id": "7fdb5f66-c385-40ac-85df-c88a57ae874c",
      "name": "Combine Clips",
      "credentials": {
        "httpHeaderAuth": {
          "id": "N0ydyTolezLzEPor",
          "name": "Header Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776186,
        "rowId": "={{ $json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604680,
              "fieldValue": "={{ $json.response }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        2240,
        3088
      ],
      "id": "e9b65383-cd67-4d53-b281-2c30e6470d4e",
      "name": "Update a row4",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776290,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604659,
                "value": "={{ $json.id }}"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1408,
        3088
      ],
      "id": "72c72113-01a0-4c49-9df5-ef9b713754ea",
      "name": "Get Scenes1",
      "alwaysOutputData": true,
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776186,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604680,
                "operator": "empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        960,
        3088
      ],
      "id": "5b516466-45bf-4656-b258-d76603eea75e",
      "name": "Get Videos",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8080/v1/ffmpeg/compose",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"id\": \"audio-layering\",\n    \"inputs\": [\n        {\n            \"file_url\": \"{{ $json['Raw Video URL'] }}\"\n        },\n        {\n            \"file_url\": \"{{ $json['tts audio'][0]['url'] }}\"\n        }\n    ],\n    \"filters\": [\n        {\n            \"filter\": \"[1:a]volume=1[outa]\"\n        }\n    ],\n    \"outputs\": [\n        {\n            \"options\": [\n                {\n                    \"option\": \"-map\",\n                    \"argument\": \"0:v\"\n                },\n                {\n                    \"option\": \"-map\",\n                    \"argument\": \"[outa]\"\n                },\n                {\n                    \"option\": \"-c:v\",\n                    \"argument\": \"copy\"\n                },\n                {\n                    \"option\": \"-c:a\",\n                    \"argument\": \"aac\"\n                }\n            ]\n        }\n    ]\n}\n",
        "options": {
          "timeout": 50000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1232,
        3424
      ],
      "id": "2dd1d6d1-b909-4254-8358-f2b26e8057e0",
      "name": "Combine Clips3",
      "credentials": {
        "httpHeaderAuth": {
          "id": "N0ydyTolezLzEPor",
          "name": "Header Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776186,
        "rowId": "={{ $('Get many rows3').item.json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604679,
              "fieldValue": "={{ $json.response[0].file_url }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1440,
        3424
      ],
      "id": "2cf7d449-ed5d-4157-8c01-b061569e7eb3",
      "name": "Update a row5",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Combine Video & Audio",
        "height": 240,
        "width": 720,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        944,
        3360
      ],
      "id": "b23ec7a7-954e-4d4d-a7d4-7c763d11f679",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "## Combine clips into 1 video",
        "height": 300,
        "width": 1460,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        944,
        2992
      ],
      "id": "e25326b1-a81b-4ddc-881c-3a173aee7764",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776186,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604679,
                "operator": "empty"
              },
              {
                "field": 6604680,
                "operator": "not_empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1024,
        3424
      ],
      "id": "662d8a3e-9f1d-484e-b7dc-7970647143c9",
      "name": "Get many rows3",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:8080/v1/video/caption",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"video_url\": \"{{ $json['Video + Audio URL'] }}\",\n  \"settings\": {\n    \"line_color\": \"#FFFFFF\",\n    \"word_color\": \"#FFF200\",\n    \"all_caps\": true,\n    \"max_words_per_line\": 3,\n    \"font_size\": 108,\n    \"bold\": false,\n    \"italic\": false,\n    \"underline\": false,\n    \"strikeout\": false,\n    \"outline_width\": 4,\n    \"shadow_offset\": 2,\n    \"style\": \"highlight\",\n    \"font_family\": \"The Bold Font\",\n    \"position\": \"bottom_center\"\n  },\n  \"id\": \"{{ $json.id }}\"\n}",
        "options": {
          "timeout": 9000000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1184,
        3744
      ],
      "id": "30f69837-b041-4355-8ddc-f8ec0729fbc8",
      "name": "Create Captions",
      "credentials": {
        "httpHeaderAuth": {
          "id": "N0ydyTolezLzEPor",
          "name": "Header Auth account 2"
        }
      }
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776186,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604678,
                "operator": "empty"
              },
              {
                "field": 6604679,
                "operator": "not_empty"
              },
              {
                "field": 6604582,
                "operator": "not_empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        992,
        3744
      ],
      "id": "797e8be0-7523-46ec-b7bb-1595a1ca1093",
      "name": "Baserow13",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776186,
        "rowId": "={{ $('Baserow13').item.json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604678,
              "fieldValue": "={{ $json.response }}"
            },
            {
              "fieldId": 6602460,
              "fieldValue": "false"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1376,
        3744
      ],
      "id": "c9db109a-12dc-4e70-b8f8-5ac5c423cfc3",
      "name": "Baserow14",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Add Captions",
        "height": 240,
        "width": 720,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        944,
        3664
      ],
      "id": "784f891b-56d5-4caf-b378-4e474c317a0a",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=The Topic:\n{{ $json.text }}",
        "messages": {
          "messageValues": [
            {
              "message": "=# ROLE\n\nYou are a Senior Financial Commentator and Script Editor. Your persona is a \"Knowledgeable Realist\"â€”blending the conversational, unscripted flow of a top-tier streamer with the deep structural discipline of a macro analyst.\n\n\n# THE GOAL\n\nRewrite raw transcripts into a high-performance 70/30 Fusion Commentary Script:\n\n- 70% Structural Analysis: Focus on mechanics, incentives, debt, and the \"Broken Rules\" of finance.\n\n- 30% Urgent Catalyst: Anchor the analysis to specific dates, upcoming events, or systemic \"bombs\".\n\n\n# TONE & VOICE\n\n- Direct & Skeptical: Opinionated about logic, not people. Critique arguments with math, not emotion.\n\n- Dramatic Tension (30%): Use punchy urgency in hooks and pivots\n\n- Metaphorical Precision: Use one high-stakes imagery per script\n\n- Professional Vocabulary: Strictly avoid internet/gamer slang (no \"chat,\" \"boys,\" or \"cringe\").\n\n\n# ENGAGEMENT & LOGIC FRAMEWORK\n\n- The 10-Second Payoff: State the topic, why it matters now, and hint at what they will understand by the end.\n\n- Narrative Anchor (Required): Create one named idea per script (e.g., â€œThe Repatriation Mythâ€). Repeat it 2â€“3 times to reinforce memory.\n\n- Cause â†’ Effect Loops: Every major point must show: Policy â†’ Mechanic â†’ Consequence â†’ Who it hits.\n\n- Pattern Interrupts: Drop short standalone truths every 60â€“90 seconds\n\n\n# EDITORIAL STRUCTURE (Internal Logic)\n\n1. The Hook: High-tension immediacy.\n\n2. The Surface: Briefly acknowledge the headline narrative to hook search-intent viewers.\n\n3. The Pivot: Build tension: \"Everyone's saying X. But here's the hidden crack no one's watching.\"\n\n4. The Deep Dive: The bulk of the script (70% mechanics). Weave in historical parallels (e.g., 1929, 2008).\n\n5. The Nuance: Challenge emotional reactions/apocalypse framing.\n\n6. The Takeaway: Grounded outcome.\n\n\n# WRITING RULES\n\n- Sentence Rhythm: Short, punchy sentences. Fragments allowed for emphasis.\n\n- Conciseness: If a line doesnâ€™t add information, cut it. No flowery descriptions.\n\n- Pattern Interrupts: Use 1-2 standalone single lines per script for hard truths.\n\n- Formatting: Plain text for delivery. No bolding. No headers in the script.\n\nINPUT TRANSCRIPT: {{ $json.text }}\n\nOUTPUT INSTRUCTIONS: Produce ONLY the spoken-word script. Execute the Hook Protocol immediately."
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        1216,
        416
      ],
      "id": "8be43775-bd69-4e9d-8d05-9a341f5ab3af",
      "name": "Script Writer ðŸ§ "
    },
    {
      "parameters": {
        "model": "deepseek/deepseek-v3.2",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1280,
        624
      ],
      "id": "c78f52a3-f5ee-4895-83ef-19c8df4e649e",
      "name": "OpenRouter - Deepseek",
      "credentials": {
        "openRouterApi": {
          "id": "WwFsBIGbdM1v2Glq",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"title\": {\n      \"type\": \"string\",\n      \"description\": \"A high-CTR title under 60 chars. Must highlight a paradox, a broken mechanism, or a hidden cost. No 'How to'.\"\n    },\n    \"description_hook\": {\n      \"type\": \"string\",\n      \"description\": \"The first 2-3 sentences of the description. Structure: State the conventional wisdom, then immediately contradict it with the 'scary truth'.\"\n    },\n    \"hashtags\": {\n      \"type\": \"string\",\n      \"description\": \"5-7 relevant hashtags separated by spaces. Example: #Economy #Gold #Recession\"\n    }\n  },\n  \"required\": [\n    \"title\",\n    \"description_hook\",\n    \"hashtags\"\n  ]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1632,
        624
      ],
      "id": "d2fa7378-92fa-44d6-b644-03b3b26703ea",
      "name": "Structured Output Parser2"
    },
    {
      "parameters": {
        "operation": "create",
        "databaseId": 339384,
        "tableId": 776186,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6602459,
              "fieldValue": "={{ $('Script Writer ðŸ§ ').item.json.text }}"
            },
            {
              "fieldId": 6602458,
              "fieldValue": "={{ $json.output.title }}"
            },
            {
              "fieldId": 6604681,
              "fieldValue": "={{ $json.output.description_hook }} \n\n{{ $json.output.hashtags }}\n\nðŸ”” Subscribe to Financial History and Markets to master the cycles of history and navigate the complexity of modern markets.\n\nâš ï¸ Disclaimer: All content is for educational and illustrative purposes only; it does not constitute financial, investment, or legal advice. Markets carry inherent risks, and historical precedents are not guarantees of future outcomes.\n\nâš ï¸ AI Transparency: This video uses AI-assisted visuals and narration. All research, analysis, and scripting are done by me, the author."
            },
            {
              "fieldId": 6676023,
              "fieldValue": "={{ $('1st Pass').item.json.text }}"
            },
            {
              "fieldId": 6602460,
              "fieldValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1776,
        416
      ],
      "id": "471ffd9e-19fc-4dbb-9fbf-75635303e209",
      "name": "Upload Fields to Baserow",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Here are the raw notes for the video:\n{{ $json.text }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=You are a viral YouTube strategist for a 'Macro-Doom' finance channel.\nYour goal is to generate titles that trigger immediate fear or curiosity (FOMO).\n\n### THE RULE OF ABSOLUTES\n- NEVER describe a process (e.g., \"Market is slowing,\" \"Yields are rising,\" \"Pushing a domino\").\n- ALWAYS declare the RESULT (e.g., \"The Dollar Died,\" \"The Market is Fake,\" \"Japan Broke It\").\n- The event must sound like it has ALREADY happened or is INEVITABLE.\n\n### STRICT TITLE FORMULAS (USE THESE ONLY):\n1. The \"Broken\" Frame: \"[Subject] Just Broke the [Object]\"\n   (e.g., \"Japan Just Broke the Global Economy\")\n2. The \"Lie\" Frame: \"The [Subject] Lie No One Is Telling\"\n   (e.g., \"The Inflation Lie No One Is Telling\")\n3. The \"Paradox\" Frame: \"Why [Subject] is Defying Logic\"\n   (e.g., \"Why Gold is Defying Logic\")\n4. The \"Finality\" Frame: \"The End of [Subject] is Here\"\n   (e.g., \"The End of the US Dollar\")\n\n### INSTRUCTIONS:\n1. Analyze the user notes for the most dangerous mechanism.\n2. Select one of the \"Title Formulas\" above that fits best.\n3. Apply aggressive vocabulary: VAPORIZED, ENGINEERED, TRAP, DEAD, FAKE, ZERO.\n\n### OUTPUT JSON:\n{\n  \"title\": \"Under 50 chars. High impact. No metaphors.\",\n  \"description_hook\": \"Sentence 1: State what the textbook says (The Lie). Sentence 2: State the brutal reality (The Mechanism).\",\n  \"hashtags\": \"5-7 broad, high-volume tags.\"\n}"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        1488,
        416
      ],
      "id": "02ce8f4c-c858-4d00-a014-c16a827eadb5",
      "name": "Title Generator"
    },
    {
      "parameters": {
        "content": "## Create script & title",
        "height": 468,
        "width": 1148,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        912,
        320
      ],
      "id": "efc299ac-7d7a-44ef-9f20-bef5e79101e4",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Generate scenes & image prompts\n",
        "height": 832,
        "width": 2204,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        912,
        1264
      ],
      "id": "caf065c1-20a2-43fc-9289-d9794f43afc1",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "## Generate Captions from TTS",
        "height": 292,
        "width": 1960,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        928,
        864
      ],
      "id": "edc5ef72-17d4-4413-84e1-bfb34c8243ed",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Image Generation",
        "height": 328,
        "width": 1280,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        928,
        2160
      ],
      "id": "debb00cc-d92d-4bfe-8d6b-95883bc7c2a2",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "## Create clips from images\n",
        "height": 352,
        "width": 1240,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        944,
        2576
      ],
      "id": "7bf3a7a2-92e5-4a57-8aaf-34550d5fc498",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776186,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604582,
                "operator": "not_empty"
              },
              {
                "field": 6604674,
                "operator": "empty"
              },
              {
                "field": 6604680,
                "operator": "empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        976,
        1312
      ],
      "id": "90a1840b-d61c-48e0-a313-a95bf69521f9",
      "name": "Get many rows1",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json['captions url'] }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1184,
        1312
      ],
      "id": "be085319-0f14-499e-823e-341e7dde4a5e",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "jsCode": "// =========================================================\n// 1. GET PARENT ID (The Video ID)\n// =========================================================\n// We grab the ID from the node before the HTTP Request\n// Ensure the node name matches exactly what is in your canvas\nconst parentId = $('Get many rows1').first().json.id;\n\n// =========================================================\n// 2. HELPER FUNCTIONS\n// =========================================================\nfunction srtToSeconds(srtTime) {\n  const [h, m, s] = srtTime.replace(\",\", \".\").split(\":\");\n  return (+h * 3600) + (+m * 60) + parseFloat(s);\n}\n\n// Clean floating point artifacts (Round to 4 decimals)\nfunction cleanFloat(num) {\n  return Math.round(num * 10000) / 10000;\n}\n\n// =========================================================\n// 3. PARSE SRT\n// =========================================================\nconst rawSrt = $input.first().json.data;\nconst blocks = rawSrt.trim().split(/\\n\\s*\\n/);\n\nconst parsed = blocks\n  .map((block) => {\n    const lines = block.split(\"\\n\");\n    if (lines.length < 3) return null;\n\n    const [startStr, endStr] = lines[1].split(\" --> \");\n    return { \n      start_time: srtToSeconds(startStr),\n      end_time: srtToSeconds(endStr),\n      word: lines.slice(2).join(\" \").trim()\n    };\n  })\n  .filter(Boolean);\n\n// =========================================================\n// 4. BUILD OUTPUT\n// =========================================================\nreturn parsed.map((cur, i) => {\n  const next = parsed[i + 1];\n  \n  // Raw Calculations\n  const raw_segment_end = next ? next.start_time : cur.end_time;\n  const raw_duration = Math.max(0, raw_segment_end - cur.start_time);\n  const raw_speech = Math.max(0, cur.end_time - cur.start_time);\n  const raw_gap = next ? Math.max(0, next.start_time - cur.end_time) : 0;\n\n  return {\n    json: {\n      parent_id: parentId, // <--- CRITICAL UPDATE: Passes the Video ID forward\n      id: i + 1,\n      word: cur.word,\n      start_time: cleanFloat(cur.start_time),\n      end_time: cleanFloat(cur.end_time),\n      segment_end: cleanFloat(raw_segment_end),\n      speech_duration: cleanFloat(raw_speech),\n      gap_to_next: cleanFloat(raw_gap),\n      duration: cleanFloat(raw_duration)\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        1312
      ],
      "id": "d1b4bcde-924a-483e-b0d5-bce496d9cd2b",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.word }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=Role: You are a Satirical Financial Art Director.\nTask: Translate the \"Input Text\" below into a physical, finance-themed visual scene.\nFormat: Output ONLY the JSON object below.\n\nInput Text: {{ $json.word }}\n\nRules for Translation:\n1. **Theme:** The visual must relate to the world of macroeconomics, crypto, or finance.\n2. **Creativity:** You have total freedom to invent the visual metaphor.\n3. **Constraint:** Ensure the description is of a physical object or scene (no abstract text), suitable for a heavy texture painting.\n\nOutput Template:\n{\n  \"Prompt\": \"A thick impasto oil painting with a clear central subject dominating the frame: [INSERT YOUR FINANCIAL VISUAL TRANSLATION HERE]. Heavy palette-knife application, layered paint ridges, visible canvas grain. Loose but legible forms, uncluttered composition. Use natural, scene-appropriate lighting and mood. Color and emotion should come from the subject itself. Analog hand-painted fine art, non-digital, painterly realism.\"\n}"
            }
          ]
        },
        "batching": {
          "batchSize": 1,
          "delayBetweenBatches": 500
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1568,
        1312
      ],
      "id": "dadee024-a347-4e8d-827f-1e2a89d543e4",
      "name": "Image Prompter V2 ðŸ“·",
      "retryOnFail": false,
      "waitBetweenTries": 5000,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": "deepseek/deepseek-chat-v3.1",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        1568,
        1504
      ],
      "id": "401b4db1-4c20-4434-a9ae-4f86d8d36a51",
      "name": "OpenRouter - Deepseek3",
      "credentials": {
        "openRouterApi": {
          "id": "WwFsBIGbdM1v2Glq",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"Prompt\": \"enter prompt here\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1696,
        1504
      ],
      "id": "061ec8c3-900b-4a8a-a455-6cebce5633d8",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "operation": "create",
        "databaseId": 339384,
        "tableId": 776290,
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604660,
              "fieldValue": "={{ $json.output.Prompt }}"
            },
            {
              "fieldId": 6604661,
              "fieldValue": "={{$('Code in JavaScript1').item.json.duration}}"
            },
            {
              "fieldId": 6631814,
              "fieldValue": "={{$('Code in JavaScript1').item.json.segment_end}}"
            },
            {
              "fieldId": 6647664,
              "fieldValue": "={{ $('Code in JavaScript1').item.json.word }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1888,
        1312
      ],
      "id": "641cf38a-bf8e-4ce5-953c-7fa5c12d563a",
      "name": "Create a row",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "include": "specifiedFields",
        "fieldsToInclude": "id",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2128,
        1312
      ],
      "id": "720aa0e9-c5bd-43ef-8912-d7e379ed2b19",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "jsCode": "// Initialize an array to hold IDs\nconst ids = [];\n\n// Loop over input items\nfor (const item of $input.all()) {\n  // Loop through each 'data' array\n  for (const dataItem of item.json.data) {\n    // Check if 'id' is defined\n    if (dataItem.id) {\n      // Push the ID into the array\n      ids.push(dataItem.id);\n    }\n  }\n}\n\n// Return the array wrapped in an object\nreturn [{ json: { ids } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2336,
        1312
      ],
      "id": "48c67171-a848-4e7d-8ee1-581fa1619928",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776186,
        "rowId": "={{ $('Get many rows1').first().json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604674,
              "fieldValue": "={{ $json.ids }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        2544,
        1312
      ],
      "id": "b539d5c4-7f93-4398-9632-040c5db7510b",
      "name": "Update a row1",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776290,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6647664,
                "operator": "not_empty"
              },
              {
                "field": 6604660,
                "operator": "empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        992,
        1744
      ],
      "id": "f0e08ca2-e8b4-49ba-8f0e-c4a1f0f9c533",
      "name": "Get many rows4",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json['initial prompt'] }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=Role: You are a Satirical Financial Art Director.\nTask: Translate the \"Input Text\" below into a physical, finance-themed visual scene.\nFormat: Output ONLY the JSON object below.\n\nInput Text: {{ $json['initial prompt'] }}\n\nRules for Translation:\n1. **Theme:** The visual must relate to the world of macroeconomics, crypto, or finance.\n2. **Creativity:** You have total freedom to invent the visual metaphor.\n3. **Constraint:** Ensure the description is of a physical object or scene (no abstract text), suitable for a heavy texture painting.\n\nOutput Template:\n{\n  \"Prompt\": \"A thick impasto oil painting with a clear central subject dominating the frame: [INSERT YOUR FINANCIAL VISUAL TRANSLATION HERE]. Heavy palette-knife application, layered paint ridges, visible canvas grain. Loose but legible forms, uncluttered composition. Use natural, scene-appropriate lighting and mood. Color and emotion should come from the subject itself. Analog hand-painted fine art, non-digital, painterly realism.\"\n}"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1424,
        1760
      ],
      "id": "3ee87008-2cf0-4e2a-81bf-6bc409330ecc",
      "name": "Image Prompter V2 ðŸ“·1"
    },
    {
      "parameters": {
        "databaseId": 339384,
        "tableId": 776186,
        "returnAll": true,
        "additionalOptions": {
          "filters": {
            "fields": [
              {
                "field": 6604538,
                "operator": "not_empty"
              },
              {
                "field": 6604582,
                "operator": "empty"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        976,
        960
      ],
      "id": "f5bef9d1-4d65-4bcf-ab37-49a6495a1cd6",
      "name": "Get many rows5",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json['tts audio'][0]['url'] }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1184,
        960
      ],
      "id": "ff762bef-032d-492a-924c-500eb4f34bd4",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Input Transcript:\n{{ $json.fullText }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=ROLE: You are a Lead Research Analyst. Your job is to extract the \"Signal\" from the \"Noise\" for a senior scriptwriter.\n\nTHE TASK: Process the Input Transcript into a clean, logical briefing.\n\nOPERATIONAL RULES:\n1. STRICTLY REMOVE FLUFF: Delete all host introductions, channel plugs (\"subscribe,\" \"link below,\" \"smash the like\"), sales pitches (\"join our membership\"), and verbal filler.\n2. CONSOLIDATE LOGIC: If the speaker repeats the same point three times, state it once clearly.\n3. PRESERVE HARD DATA: Do NOT summarize numbers. Keep every specific yield percentage, debt amount ($), date, and financial metric exactly as stated.\n4. RESTRUCTURE: Organize the text into a logical flow: Context -> The Trigger -> The Mechanism -> The Implication.\n\nOUTPUT: Provide ONLY the cleaned, dense narrative text. No bullet points, no headers."
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.5,
      "position": [
        944,
        416
      ],
      "id": "85eada86-2472-4d38-be54-9fefa09bc9ce",
      "name": "1st Pass"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        928,
        80
      ],
      "id": "6d357c6c-a7fd-4020-aa98-a4b3cf154d15",
      "name": "When chat message received",
      "webhookId": "033ad06a-bf78-46bc-aaf0-e9a0e48055bf"
    },
    {
      "parameters": {
        "jsCode": "// Expert Protocol: Purge original metadata and return only the merged text\nreturn $input.all().map(item => {\n  return {\n    json: {\n      fullText: item.json.content.map(segment => segment.text).join(' ')\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        80
      ],
      "id": "1b6cf4ee-a5a5-4395-929f-59ca3f64acec",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "content": "## Pull Raw Transcript & Idea",
        "height": 276,
        "width": 684,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        896,
        0
      ],
      "id": "096e3d21-1bb5-4678-b6d9-c14b95b4a862",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1200,
        1744
      ],
      "id": "6d4aa3ca-02e2-49d9-8211-f5bbb967cfb2",
      "name": "Loop Over Items2"
    },
    {
      "parameters": {
        "operation": "update",
        "databaseId": 339384,
        "tableId": 776290,
        "rowId": "={{ $('Loop Over Items2').item.json.id }}",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": 6604660,
              "fieldValue": "={{ $json.output.Prompt }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.baserow",
      "typeVersion": 1,
      "position": [
        1712,
        1760
      ],
      "id": "713feb5c-21e5-4074-b122-ebcacc665dab",
      "name": "Update a row6",
      "credentials": {
        "baserowApi": {
          "id": "5BFgA4UpsK8GRlHn",
          "name": "Baserow account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getTranscript",
        "videoUrl": "={{ $json.chatInput }}"
      },
      "type": "n8n-nodes-supadata.supadata",
      "typeVersion": 1,
      "position": [
        1120,
        80
      ],
      "id": "a1eb8de8-f946-4db8-82e4-0414b522f58c",
      "name": "Get transcript1",
      "credentials": {
        "supadataApi": {
          "id": "4pV75SGmYCEwlIUJ",
          "name": "Supadata account"
        }
      }
    },
    {
      "parameters": {
        "workflow": "={\n  \"6\": {\n    \"inputs\": {\n      \"text\": \"{{ $('Get Scenes').item.json.Prompt }}\",\n      \"clip\": [\n        \"189\",\n        0\n      ]\n    },\n    \"class_type\": \"CLIPTextEncode\",\n    \"_meta\": {\n      \"title\": \"CLIP Text Encode (Prompt)\"\n    }\n  },\n  \"27\": {\n    \"inputs\": {\n      \"vae_name\": \"ae.safetensors\"\n    },\n    \"class_type\": \"VAELoader\",\n    \"_meta\": {\n      \"title\": \"Load VAE\"\n    }\n  },\n  \"162\": {\n    \"inputs\": {\n      \"width\": 2560,\n      \"height\": 1920,\n      \"batch_size\": 1\n    },\n    \"class_type\": \"EmptySD3LatentImage\",\n    \"_meta\": {\n      \"title\": \"EmptySD3LatentImage (Taller for Panning)\"\n    }\n  },\n  \"163\": {\n    \"inputs\": {\n      \"seed\": \"{{ Math.floor(Math.random() * 999999999) }}\",\n      \"steps\": 5,\n      \"cfg\": 1,\n      \"sampler_name\": \"dpmpp_sde\",\n      \"scheduler\": \"beta\",\n      \"denoise\": 1,\n      \"model\": [\n        \"191\",\n        0\n      ],\n      \"positive\": [\n        \"6\",\n        0\n      ],\n      \"negative\": [\n        \"190\",\n        0\n      ],\n      \"latent_image\": [\n        \"162\",\n        0\n      ]\n    },\n    \"class_type\": \"KSampler\",\n    \"_meta\": {\n      \"title\": \"KSampler\"\n    }\n  },\n  \"164\": {\n    \"inputs\": {\n      \"samples\": [\n        \"163\",\n        0\n      ],\n      \"vae\": [\n        \"27\",\n        0\n      ]\n    },\n    \"class_type\": \"VAEDecode\",\n    \"_meta\": {\n      \"title\": \"VAE Decode\"\n    }\n  },\n  \"171\": {\n    \"inputs\": {\n      \"images\": [\n        \"164\",\n        0\n      ]\n    },\n    \"class_type\": \"PreviewImage\",\n    \"_meta\": {\n      \"title\": \"Preview Image\"\n    }\n  },\n  \"188\": {\n    \"inputs\": {\n      \"unet_name\": \"z_image_turbo_bf16.safetensors\",\n      \"weight_dtype\": \"default\"\n    },\n    \"class_type\": \"UNETLoader\",\n    \"_meta\": {\n      \"title\": \"Load Diffusion Model\"\n    }\n  },\n  \"189\": {\n    \"inputs\": {\n      \"clip_name\": \"qwen_3_4b.safetensors\",\n      \"type\": \"lumina2\",\n      \"device\": \"default\"\n    },\n    \"class_type\": \"CLIPLoader\",\n    \"_meta\": {\n      \"title\": \"Load CLIP\"\n    }\n  },\n  \"190\": {\n    \"inputs\": {\n      \"conditioning\": [\n        \"6\",\n        0\n      ]\n    },\n    \"class_type\": \"ConditioningZeroOut\",\n    \"_meta\": {\n      \"title\": \"ConditioningZeroOut\"\n    }\n  },\n  \"191\": {\n    \"inputs\": {\n      \"shift\": 3,\n      \"model\": [\n        \"197\",\n        0\n      ]\n    },\n    \"class_type\": \"ModelSamplingAuraFlow\",\n    \"_meta\": {\n      \"title\": \"ModelSamplingAuraFlow\"\n    }\n  },\n  \"194\": {\n    \"inputs\": {\n      \"sage_attention\": \"auto\",\n      \"allow_compile\": false,\n      \"model\": [\n        \"196\",\n        0\n      ]\n    },\n    \"class_type\": \"PathchSageAttentionKJ\",\n    \"_meta\": {\n      \"title\": \"Pathch Sage Attention KJ\"\n    }\n  },\n  \"196\": {\n    \"inputs\": {\n      \"width\": 2560,\n      \"height\": 1920,\n      \"model_type\": \"zimage\",\n      \"method\": \"yarn\",\n      \"yarn_alt_scaling\": 2,\n      \"enable_dype\": 0.1,\n      \"base_resolution\": 1024,\n      \"dype_start_sigma\": 1,\n      \"dype_scale\": 2,\n      \"dype_exponent\": 1,\n      \"base_shift\": 0.5,\n      \"max_shift\": 1.15,\n      \"model\": [\n        \"188\",\n        0\n      ]\n    },\n    \"class_type\": \"DyPE_FLUX\",\n    \"_meta\": {\n      \"title\": \"DyPE\"\n    }\n  },\n  \"197\": {\n    \"inputs\": {\n      \"enable_fp16_accumulation\": true,\n      \"model\": [\n        \"194\",\n        0\n      ]\n    },\n    \"class_type\": \"ModelPatchTorchSettings\",\n    \"_meta\": {\n      \"title\": \"Model Patch Torch Settings\"\n    }\n  }\n}"
      },
      "type": "n8n-nodes-comfyui.comfyui",
      "typeVersion": 1,
      "position": [
        1392,
        2256
      ],
      "id": "9105cda0-c348-4062-b7fc-ca395b8ac285",
      "name": "ComfyUI",
      "credentials": {
        "comfyUIApi": {
          "id": "7cIpzCySFo5dHufK",
          "name": "ComfyUI account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "command": "=mkdir -p /home/node/.n8n-files && \\\nwget -O /home/node/.n8n-files/temp_image_{{ $runIndex }}.jpg \"{{ $json.Image[0].url }}\" && \\\nffmpeg -y -loop 1 -i /home/node/.n8n-files/temp_image_{{ $runIndex }}.jpg \\\n-vf \"crop=w=2560:h=1440:x=0:y='{{ $runIndex % 2 === 0 ? \"120+(240*(1-t/\" + $json.Duration + \"))\" : \"120+(240*(t/\" + $json.Duration + \"))\" }}',setsar=1\" \\\n-c:v libx264 -crf 18 -t {{ $json.Duration }} -pix_fmt yuv420p -preset fast /home/node/.n8n-files/temp_video_{{ $runIndex }}.mp4"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        1792,
        2720
      ],
      "id": "ca6f358a-abd4-46c6-9877-049b7ff70bb1",
      "name": "Execute Command"
    },
    {
      "parameters": {
        "fileSelector": "=/home/node/.n8n-files/temp_video_{{ $runIndex }}.mp4",
        "options": {
          "fileName": "data"
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1.1,
      "position": [
        2000,
        2720
      ],
      "id": "47c16af3-8d43-482a-a4c3-9a1263078009",
      "name": "Read/Write Files from Disk"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.baserow.io/api/user-files/upload-file/",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2208,
        2720
      ],
      "id": "b9a49312-7e1d-4722-be77-cdad40fe3479",
      "name": "HTTP Request4",
      "credentials": {
        "httpHeaderAuth": {
          "id": "gvKd90Uzwvft8lDn",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "command": "=rm /home/node/.n8n-files/temp_image_{{ $runIndex }}.jpg /home/node/.n8n-files/temp_video_{{ $runIndex }}.mp4"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [
        2560,
        2720
      ],
      "id": "db17802e-1812-47ae-8037-89a634b9624d",
      "name": "Execute Command1"
    }
  ],
  "pinData": {},
  "connections": {
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Update a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Scenes": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "ComfyUI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP - Upload To Baserow": {
      "main": [
        [
          {
            "node": "Update a row2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a row2": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Video1": {
      "main": [
        [
          {
            "node": "Split Out2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out2": {
      "main": [
        [
          {
            "node": "Get many rows2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Execute Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a row3": {
      "main": [
        [
          {
            "node": "Execute Command1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows2": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Get Scenes1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Video URL to Array",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Video URL to Array": {
      "main": [
        [
          {
            "node": "Combine Clips",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine Clips": {
      "main": [
        [
          {
            "node": "Update a row4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Scenes1": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Videos": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Combine Clips3": {
      "main": [
        [
          {
            "node": "Update a row5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows3": {
      "main": [
        [
          {
            "node": "Combine Clips3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Script Writer ðŸ§ ": {
      "main": [
        [
          {
            "node": "Title Generator",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter - Deepseek": {
      "ai_languageModel": [
        [
          {
            "node": "Script Writer ðŸ§ ",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Title Generator",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "1st Pass",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser2": {
      "ai_outputParser": [
        [
          {
            "node": "Title Generator",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Title Generator": {
      "main": [
        [
          {
            "node": "Upload Fields to Baserow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows1": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Image Prompter V2 ðŸ“·",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image Prompter V2 ðŸ“·": {
      "main": [
        [
          {
            "node": "Create a row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter - Deepseek3": {
      "ai_languageModel": [
        [
          {
            "node": "Image Prompter V2 ðŸ“·",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Image Prompter V2 ðŸ“·1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Image Prompter V2 ðŸ“·",
            "type": "ai_outputParser",
            "index": 0
          },
          {
            "node": "Image Prompter V2 ðŸ“·1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Create a row": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "Update a row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows4": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows5": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1st Pass": {
      "main": [
        [
          {
            "node": "Script Writer ðŸ§ ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Get transcript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "1st Pass",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items2": {
      "main": [
        [],
        [
          {
            "node": "Image Prompter V2 ðŸ“·1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image Prompter V2 ðŸ“·1": {
      "main": [
        [
          {
            "node": "Update a row6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a row6": {
      "main": [
        [
          {
            "node": "Loop Over Items2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Baserow13": {
      "main": [
        [
          {
            "node": "Create Captions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Captions": {
      "main": [
        [
          {
            "node": "Baserow14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get transcript1": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ComfyUI": {
      "main": [
        [
          {
            "node": "HTTP - Upload To Baserow",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Get Video1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command": {
      "main": [
        [
          {
            "node": "Read/Write Files from Disk",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read/Write Files from Disk": {
      "main": [
        [
          {
            "node": "HTTP Request4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request4": {
      "main": [
        [
          {
            "node": "Update a row3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute Command1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "10e77a18-d55f-4dbe-9d58-e575a31abf2d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "9a23dd656dc136b7a946e80b63599231fa365bcdc0c072e76464715260007374"
  },
  "id": "l4Zvjht3P4yx4TqM",
  "tags": [
    {
      "updatedAt": "2025-12-31T19:14:12.825Z",
      "createdAt": "2025-12-31T19:14:12.825Z",
      "id": "AFqzIbH4PpbqYCPB",
      "name": "Youtube-Finance"
    }
  ]
}